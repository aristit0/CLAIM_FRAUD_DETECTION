<!DOCTYPE html>
<html>
<head>
    <title>Claim Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <style>
        .page-link-active {
            background-color: #2563eb;
            color: white;
        }
    </style>
</head>

<body class="bg-gray-900 text-white min-h-screen">

<div class="max-w-7xl mx-auto py-10">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Claim Dashboard</h1>
        <a href="/logout" class="text-red-400 hover:underline">Logout</a>
    </div>

    <!-- SEARCH BAR -->
    <div class="mb-6">
        <input id="searchInput"
               onkeyup="filterTable()"
               placeholder="Search claim ID or patient name..."
               class="w-full p-3 rounded bg-gray-800 text-white outline-none border border-gray-700 focus:ring-2 focus:ring-blue-500">
    </div>

    <!-- CLAIMS TABLE -->
    <div class="overflow-x-auto">
        <table id="claimsTable" class="w-full border-collapse">
            <thead>
                <tr class="text-gray-300 bg-gray-800">
                    <th class="p-3 text-left">Claim ID</th>
                    <th class="p-3 text-left">Patient</th>
                    <th class="p-3 text-left">Visit Date</th>
                    <th class="p-3 text-left">Type</th>
                    <th class="p-3 text-left">Department</th>
                    <th class="p-3 text-left">Total Amount</th>
                    <th class="p-3 text-left">Status</th>
                    <th class="p-3 text-left">Action</th>
                </tr>
            </thead>

            <tbody>
                {% for c in claims %}
                <tr class="border-t border-gray-700 hover:bg-gray-800 transition">
                    <td class="p-3">{{ c.claim_id }}</td>
                    <td class="p-3">{{ c.patient_name }}</td>
                    <td class="p-3">{{ c.visit_date }}</td>
                    <td class="p-3">{{ c.visit_type }}</td>
                    <td class="p-3">{{ c.department }}</td>
                    <td class="p-3">{{ c.total_claim_amount | rupiah }}</td>

                    <td class="p-3">
                        {% if c.status == "approved" %}
                            <span class="bg-green-700 text-green-200 px-2 py-1 rounded text-xs">Approved</span>
                        {% elif c.status == "declined" %}
                            <span class="bg-red-700 text-red-200 px-2 py-1 rounded text-xs">Declined</span>
                        {% elif c.status == "manual_review" %}
                            <span class="bg-yellow-700 text-yellow-200 px-2 py-1 rounded text-xs">Manual Review</span>
                        {% elif c.status == "approved_partial" %}
                            <span class="bg-blue-700 text-blue-200 px-2 py-1 rounded text-xs">Partial</span>
                        {% elif c.status == "request_docs" %}
                            <span class="bg-purple-700 text-purple-200 px-2 py-1 rounded text-xs">Request Docs</span>
                        {% else %}
                            <span class="bg-gray-600 text-gray-300 px-2 py-1 rounded text-xs">Pending</span>
                        {% endif %}
                    </td>

                    <td class="p-3">
                        <a href="/review/{{ c.claim_id }}"
                           class="bg-blue-600 px-3 py-1 rounded hover:bg-blue-700 text-white text-sm">
                            Review
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

    <!-- PAGINATION -->
    <div class="mt-6 flex justify-center space-x-2" id="pagination"></div>

</div>


<script>
const rowsPerPage = 20;
let currentPage = 1;

function paginate() {
    const table = document.getElementById("claimsTable");
    const rows = table.querySelectorAll("tbody tr");
    const totalRows = rows.length;
    const totalPages = Math.ceil(totalRows / rowsPerPage);

    // Hide all rows
    rows.forEach(r => r.style.display = "none");

    // Show only current page
    let start = (currentPage - 1) * rowsPerPage;
    let end = start + rowsPerPage;

    rows.forEach((row, idx) => {
        if (idx >= start && idx < end) row.style.display = "";
    });

    renderPagination(totalPages);
}

function renderPagination(totalPages) {
    let container = document.getElementById("pagination");
    container.innerHTML = "";

    for (let p = 1; p <= totalPages; p++) {
        let btn = document.createElement("button");
        btn.innerText = p;

        btn.className = "px-3 py-1 rounded bg-gray-700 text-white hover:bg-gray-600";

        if (p === currentPage) {
            btn.classList.add("page-link-active");
        }

        btn.onclick = () => {
            currentPage = p;
            paginate();
        };

        container.appendChild(btn);
    }
}

function filterTable() {
    let filter = document.getElementById("searchInput").value.toLowerCase();
    let rows = document.querySelectorAll("#claimsTable tbody tr");

    rows.forEach(row => {
        let text = row.innerText.toLowerCase();
        row.style.display = text.includes(filter) ? "" : "none";
    });
}

// Initialize when page loads
window.onload = paginate;
</script>

</body>
</html>